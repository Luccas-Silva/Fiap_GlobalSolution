<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Equipes</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial, sans-serif; }
    .card {
        border: 1px solid #888;
        border-radius: 6px;
        margin-bottom: 12px;
        padding: 12px 24px;
        background: #f7f7f7;
        position: relative;
    }
    .card-actions {
        position: absolute; right: 24px; top: 16px;
    }
    .card-actions a {
        margin-left: 12px;
        color: #2d5be3;
        text-decoration: none;
    }
    .card-actions a:hover { text-decoration: underline; }
  </style>
</head>
<body>
<h2>Equipes</h2>
<div th:if="${mensagem}" style="color: green; margin-bottom: 10px;" th:text="${mensagem}"></div>
<a th:href="@{/equipe/novo}" style="margin-bottom:20px;display:inline-block;">Nova Equipe</a>

<div th:each="equipe : ${equipes}" style="margin-bottom: 16px;">
  <div class="card">
    <b th:text="${equipe.nomeEquipe}">Nome da Equipe</b> <br/>
    Área de Atuação: <span th:text="${equipe.areaAtuacao}">Área</span> <br/>
    Contato: <span th:text="${equipe.contato}">Contato</span>
    <div class="card-actions">
      <a th:href="@{|/equipe/editar/${equipe.idEquipe}|}">Editar</a>
    </div>
  </div>
  <div>
    <b>Integrantes:</b>
    <ul style="list-style: none; padding-left: 0;">
      <li th:each="usuario : ${equipe.usuarios}" style="margin-bottom: 7px;">
        <span th:text="${usuario.nome}">Nome</span>
        <span th:if="${usuario.cargo != null}">(<b th:text="${usuario.cargo}">Cargo</b>)</span>
        - <span th:text="${usuario.email}">Email</span>
        <span>
          <a th:href="@{|/usuario/editar/${usuario.idUsuario}|}">Editar</a>
          <a th:href="@{|/equipe/${equipe.idEquipe}/remover-integrante/${usuario.idUsuario}|}"
             onclick="return confirm('Remover este integrante da equipe?');">Remover</a>
        </span>
      </li>
      <li th:if="${#lists.isEmpty(equipe.usuarios)}" style="color:#888;">Nenhum integrante nesta equipe.</li>
    </ul>
    <!-- Form tradicional para adicionar integrante -->
    <form th:action="@{'/equipe/' + ${equipe.idEquipe} + '/adicionar-integrante'}" method="post" style="margin-top:8px;">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <label>Adicionar integrante:</label>
      <select name="idUsuario" required>
        <option th:each="usuario : ${usuariosDisponiveis}" th:value="${usuario.idUsuario}" th:text="${usuario.nome} + ' (' + ${usuario.email} + ')'"></option>
      </select>
      <label>Cargo:</label>
      <input type="text" name="cargo" required/>
      <button type="submit">Adicionar</button>
    </form>
  </div>
  <hr/>
</div>
</body>
</html>